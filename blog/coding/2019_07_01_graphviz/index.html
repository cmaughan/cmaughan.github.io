<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>GraphViz</title>
<meta name="description" content="ChrisMaughan.com">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="https://chrismaughan.com/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="https://chrismaughan.com/css/font-awesome.min.css">
<link rel="stylesheet" href="https://chrismaughan.com/css/owl.carousel.css">
<link rel="stylesheet" href="https://chrismaughan.com/css/owl.theme.css">


  <link href="https://chrismaughan.com/css/style.default.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="https://chrismaughan.com/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="https://chrismaughan.com/img/favicon.png">

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-142140471-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="https://chrismaughan.com">ChrisMaughan.com</a></h1>
    
      <p class="sidebar-p">I'm a programmer, working for NVIDIA.</p>
    
      <p class="sidebar-p">This site contains screenshots of personal & professional projects.</p>
    
      <p class="sidebar-p">Based in York, UK</p>
    
    <ul class="sidebar-menu">
      
        <li><a href="https://chrismaughan.com/portfolio/">Projects</a></li>
      
        <li><a href="https://chrismaughan.com/blog/">Blog</a></li>
      
        <li><a href="https://chrismaughan.com/about/">About</a></li>
      
    </ul>
    <p class="social">
  
  
  
  <a href="https://twitter.com/cmaughan" data-animate-hover="pulse" class="external twitter">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  <a href="https://linkedin.com/in/chrismaughan" data-animate-hover="pulse" class="external">
    <i class="fa fa-linkedin"></i>
  </a>
  
  
  <a href="https://stackoverflow.com/users/18942/cmaughan" data-animate-hover="pulse" class="external">
    <i class="fa fa-stack-overflow"></i>
  </a>
  
  
  <a href="https://github.com/cmaughan" data-animate-hover="pulse" class="external">
    <i class="fa fa-github"></i>
  </a>
  
  
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2019 Chris Maughan
        
        | Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="https://chrismaughan.com">ChrisMaughan.com</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>GraphViz</h1>
         <p>GraphViz is an awesome way to visualize your code when debugging problems, and it is trivial to setup.</p>

<p>Sometimes you need to visualize data structures in your code.  GraphViz is your friend.
I&rsquo;ve been working on a live coding project in my spare time.  This weekend I worked on a parser for the little music language I&rsquo;ve been working on.  Here&rsquo;s an example line of code from the language:</p>

<p>c1 | sound(c4 e4 g4).gain(.5)</p>

<p>Although the language is not fully specified yet, this is a simple fragment, and enough to get me started.  The language itself is an experiment based on patterns (like Tidal Cycles) - and may well be one of several different experiments I do.  Briefly, this fragment means &lsquo;make a list of 3 notes (CEG), and apply .5 gain to it, then &lsquo;pipe&rsquo; it into audio channel 1.</p>

<p>If you aren&rsquo;t familiar with writing compilers, the basic idea is usually to decompose the code into &lsquo;tokens&rsquo; and then build a connected tree of the tokens using a parser.  The resulting data structure is called an Abstract Syntax Tree.  Once you have the AST, you can use it to generate the program you want to run.  The tree essentially shows you how to interpret the program.  The problem we have now is to check that the tree is correct.  We could just plough on and start building code fragments from the tree, but it would be nice if we could look at it.</p>

<p>I generate visualisations of tree structures by outputing the tree as a &lsquo;dot&rsquo; file representation.  This has been very useful on several occasions.</p>

<p>Dot files are a really simple format, especially if you just want a basic visualization.  To build a dot file, you just list every pair of node/child links in a text file.  You just need each node to have a unique Id.  If you provide &lsquo;label&rsquo; lines, you can also change the text of the node in the display - but you don&rsquo;t even have to do that if the node labels are nicely formed.</p>

<p>Here&rsquo;s an example:</p>

<pre><code>digraph AST 
{
    Node_1 [label = &quot;My Node 1&quot;];
    Node_3 [label = &quot;My Node 3&quot;];
    Node_Out [label = &quot;My Node Out&quot;];

    Node_1 -&gt; Node_Out;
    Node_3 -&gt; Node_Out;
}
</code></pre>

<p>It is trivial to write the above to debug output; assuming you can convert your node ID to a valid string, and you have a friendly name for it:</p>

<pre><code>std::ostringstream str;
str &lt;&lt; &quot;digraph AST\n&quot; 

// Make the labels: not usually necessary
for(auto&amp; node : nodes)
    str &lt;&lt; to_string(node.id()) &lt;&lt; &quot; [label = \&quot;&quot; &lt;&lt; node.name() &lt;&lt; &quot;\&quot;];\n&quot;;

// Make the connections (every node to every child it has)
for auto&amp; node : nodes)
{
    for(auto&amp; child : node.children)
    {
        str &lt;&lt; to_string(node.id()) &lt;&lt; &quot;-&gt;&quot; &lt;&lt; to_string(child.id()) &lt;&lt; &quot;;\n&quot;;
    }
}

str &lt;&lt; &quot;}\n&quot;;

// Log it however you want
std::cout &lt;&lt; str.str();
</code></pre>

<p>The great thing about this is you don&rsquo;t even have to install graphviz.  Just go to <a href="http://webgraphviz.com">http://webgraphviz.com</a> and paste your text.  You can download graphviz instead if you need to keep your data structure private, but I mostly just paste my tests into the site.
Here&rsquo;s what happens if you paste the digraph into webgraphviz:</p>

<p><img src="/img/blog/graphviz/simple_nodes.png" alt="Simple Example" /></p>

<p>Nice! An easy way to visualize data relationships in your code&hellip;. done.  GraphViz has many more features, and you can play with some examples on the above site too.j</p>

<p>Here is an example from the code snippet above.  You are seeing the finished, correct version of the AST tree here.  The interesting part of this exercise in visualizing my code was that the &lsquo;|&rsquo; and &lsquo;.&rsquo; operators in the graph were swapped - indicating that the &lsquo;|&rsquo; had higher precedence in my syntax parser than the &lsquo;.&rsquo;.  Fixing the preference order of the operators did not immediately fix the problem either, becuase I had actually broken the AST parsing of the operators.</p>

<p>Short story; visualize what you are doing - it can save a lot of time!  It is certainly worth the 10 minutes of effort it takes to output your data as an image.</p>

<p>If you want to learn more about language parsing, the LLVM tutorial is quite nice - and a good refresher for me!:</p>

<p><a href="https://llvm.org/docs/tutorial/">LLVM Tutorial</a></p>

<pre><code>
digraph AST 
{
Id_32 [label = &quot;P:__anon__(), Fn:=&quot;];
Id_30 [label = &quot;=&quot;];
Id_22 [label = &quot;c1&quot;];
Id_29 [label = &quot;.&quot;];
Id_26 [label = &quot;pat(...)&quot;];
Id_23 [label = &quot;c4&quot;];
Id_24 [label = &quot;e4&quot;];
Id_25 [label = &quot;g4&quot;];
Id_28 [label = &quot;gain(...)&quot;];
Id_27 [label = &quot;0.5&quot;];
Id_32-&gt;Id_30;
Id_30-&gt;Id_22;
Id_30-&gt;Id_29;
Id_29-&gt;Id_26;
Id_29-&gt;Id_28;
Id_26-&gt;Id_23;
Id_26-&gt;Id_24;
Id_26-&gt;Id_25;
Id_28-&gt;Id_27;
}
</code></pre>

<p><img src="/img/blog/graphviz/code_sample.png" alt="Parsed" /></p>
         <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "www-chrismaughan-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="https://chrismaughan.com/js/jquery.min.js"></script>
<script src="https://chrismaughan.com/js/bootstrap.min.js"></script>
<script src="https://chrismaughan.com/js/jquery.cookie.js"> </script>
<script src="https://chrismaughan.com/js/ekko-lightbox.js"></script>
<script src="https://chrismaughan.com/js/jquery.scrollTo.min.js"></script>
<script src="https://chrismaughan.com/js/masonry.pkgd.min.js"></script>
<script src="https://chrismaughan.com/js/imagesloaded.pkgd.min.js"></script>
<script src="https://chrismaughan.com/js/owl.carousel.min.js"></script>
<script src="https://chrismaughan.com/js/front.js"></script>



</body>
</html>
